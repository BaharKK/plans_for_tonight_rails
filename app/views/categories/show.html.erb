<head>
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script> 
<script type="text/javascript"> 
  var geocoder;

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(successFunction, errorFunction);
} 
//Get the latitude and the longitude;
function successFunction(position) {
    var lat = position.coords.latitude;
    var lng = position.coords.longitude;
    codeLatLng(lat, lng)
}

function errorFunction(){
    console.log("Geocoder failed");
}

  function initialize() {
    geocoder = new google.maps.Geocoder();



  }

  function codeLatLng(lat, lng) {

    var latlng = new google.maps.LatLng(lat, lng);
    geocoder.geocode({'latLng': latlng}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
      console.log(results)
        if (results[1]) {
         //formatted address
         console.log(results[0].formatted_address)
         console.log("this is the results[1] result log")
        //find country name
             for (var i=0; i<results[0].address_components.length; i++) {
            for (var b=0;b<results[0].address_components[i].types.length;b++) {

            //there are different types that might hold a city admin_area_lvl_1 usually does in come cases looking for sublocality type will be more appropriate
                if (results[0].address_components[i].types[b] == "administrative_area_level_1") {
                    //this is the object you are looking for
                    city= results[0].address_components[i];
                    break;
                }
            }
        }
        //city data
        console.log("this is the city short name:")
        console.log(city.short_name)

        console.log("this is the city long name:")
        console.log(city.long_name)


        } else {
          console.log("No results found");
        }
      } else {
        console.log("Geocoder failed due to: " + status);
      }
    });
  }
</script> 
</head> 
<body onload="initialize()"> 

<div id="categories-page">
  <%= link_to "Home", events_path %>
  <%= link_to "Edit Category", edit_category_path(@category) %>

  <h1>Categories#show</h1>
  <p>Find me in app/views/categories/show.html.erb</p>



  <div class="filters">
    <label>Location:  </label>
    <select class="option-set clearfix" data-filter-group="location">
      <option value="*" data-filter-value="" class="selected">show all</option>
      <%= @category.events.pluck(:location).uniq.each do |location| %>
        <option value="#filter-location-<%= location %>" data-filter-value=".<%= location %>"> <%= location %> </option>
      <% end %>
    </select>

    <label>Happening In:  </label>
    <select class="filter option-set clearfix" data-filter-group="time">
      <option value="*" data-filter-value="" class="selected">show all</option>
      <option value="#filter-time-twodays" data-filter-value=".twodays">under 48 hrs</option>
      <option value="#filter-time-oneday" data-filter-value=".oneday">under 24 hrs</option>
      <option value="#filter-time-twelvehours" data-filter-value=".twelvehours">under 12 hrs</option>
      <option value="#filter-time-sixhours" data-filter-value=".sixhours">under 6 hrs</option>
    </select>
  </div>

  <div class="grid"> 
   <% @category.events.future.each do |event| %>
      <div class="element-item <%= event.location %> <%= event.tags %>" data-category="<%= event.location %>">
        <%= link_to event_path(event.id) do %>
          <%= image_tag event.image_url(:thumb) if event.image? %>
        <% end %>
          <h4>Event Title: <%= link_to event.name, event_path(event.id) %> | Location: <%= event.location %></h4>
          <h4><%= formatted_date(event.show_date) %> | <%= event.duration %> mins</h4>
      </div>
    <% end %>
  </div>
</div>
</body>